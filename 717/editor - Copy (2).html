{% extends "index.html" %} {# Extends the base template #}

{% block title %}Piano Tour - Editor{% endblock %} {# Sets a specific title for this page #}

{% block editor %}
<div id="editorContainer">
    <div id="editorEditBox">
        <div id="editorExpandedEditor" class="hidden">
            <h3>Editing: <span id="editorSelectedNoteDisplay"></span></h3>

            <div id="singleNoteControls">
                <div class="control-group">
                    <label for="editorNoteLetter">Letter:</label>
                    <select id="editorNoteLetter">
                        <option value="C">C</option><option value="D">D</option><option value="E">E</option>
                        <option value="F">F</option><option value="G">G</option><option value="A">A</option>
                        <option value="B">B</option><option value="R">R (Rest)</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="editorAccidentalDropdown">Accidental:</label>
                    <select id="editorAccidentalDropdown">
                        <option value="">None</option><option value="#">#</option><option value="b">b</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="editorOctaveDropdown">Octave:</label>
                    <select id="editorOctaveDropdown">
                        <option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option>
                    </select>
                </div>
            </div>

            <div id="chordNotesEditor" class="hidden">
                <h4>Chord Notes:</h4>
                <div id="chordNotesContainer">
                    {# Chord note inputs will be dynamically populated here #}
                </div>
                <button id="addNoteToChordBtn" class="control-button bg-green-500 hover:bg-green-600">Add Note to Chord</button>
            </div>

            <div class="control-group">
                <label>Remove Selected:</label>
                <button id="editorRemoveNote" class="control-button bg-red-500 hover:bg-red-600">Remove</button>
            </div>

            <div class="control-group">
                <label>Change Clef:</label>
                <button id="editorToggleClef" class="control-button bg-gray-500 hover:bg-gray-600">Treble</button>
            </div>

            <div class="control-group">
                <label>Toggle Rest:</label>
                <button id="editorToggleRest" class="control-button bg-gray-500 hover:bg-gray-600">Toggle</button>
            </div>

            <div class="control-group">
                <label for="editorDurationDropdown">Duration:</label>
                <select id="editorDurationDropdown">
                    {# Duration options will be populated by JavaScript #}
                </select>
            </div>

            {# NEW: Move Note Options #}
            <div class="control-group">
                <label>Move Note:</label>
                <button id="editorMoveToPrevMeasure" class="control-button bg-purple-500 hover:bg-purple-600">Move to Previous Measure</button>
                <button id="editorMoveToNextMeasure" class="control-button bg-purple-500 hover:bg-purple-600">Move to Next Measure</button>
            </div>
        </div>

        <h2 id="editorControlsHeader">
            <span>Measure</span>
            <button id="editorPrevBtn" class="control-button">-</button>
            <input type="number" id="editorNumberInput" value="1" min="1">
            <button id="editorNextBtn" class="control-button">+</button>
        </h2>

        <div>
            <h3>Treble Clef Notes:</h3>
            <div id="editorTrebleNotesContainer" class="notes-container">
                {# Treble clef notes will be populated by JavaScript #}
            </div>

            <h3>Bass Clef Notes:</h3>
            <div id="editorBassNotesContainer" class="notes-container">
                {# Bass clef notes will be populated by JavaScript #}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script type="module">
    // NEW: Editor-specific JavaScript initialization
    import { initializeMusicEditor } from '{{ url_for("static", filename="musicEditorUI.js") }}';

    // It's important to ensure the DOM elements are loaded before initializing the editor.
    // The base template's DOMContentLoaded might fire before this script is parsed,
    // so we can directly call initializeMusicEditor if this script is placed at the end of body.
    // However, for robustness, wrapping in DOMContentLoaded is still a good practice.
    document.addEventListener('DOMContentLoaded', () => {
        initializeMusicEditor(); // Initialize the new editing UI
    });
</script>
{% endblock %}