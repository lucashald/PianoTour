/* ==========================================================================
   NEW DESIGN TOKENS & CSS VARIABLES (Adapted from styles.css)
   ========================================================================== */
:root {
    /* Primary Colors from new theme */
    --primary-green: #1db954;
    --primary-green-dark: #169c46;
    --primary-green-light: #1ed760;

    /* Backgrounds & Surfaces from new theme */
    --dark-bg: #282828; /* Brightened dark background */
    --glass-bg: rgba(255, 255, 255, 0.08); /* Brightened glass effect */
    --glass-border: rgba(255, 255, 255, 0.15); /* Slightly brightened border */

    /* Text Colors from new theme */
    --text-primary: #ffffff;
    --text-secondary: #b3b3b3;
    --text-muted: #777777;

    /* System Colors from new theme */
    --error: #ff6b6b;
    --success: #51cf66;
    --warning: #ffd43b;
    --info: #74c0fc;

    /* Shadows & Borders from new theme */
    --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
    --border-radius: 16px;
    --border-radius-lg: 24px;
    --border-radius-sm: 8px; /* Added from with sidebar for consistency */
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

#instrument, #instrument * {
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
}

/* ==========================================================================
   UNIFIED BUTTON SYSTEM (BEM METHODOLOGY)
   ========================================================================== */

/* --------------------------------------------------------------------------
   1. The Base Button Block (.btn)
   - This is the core class for ALL buttons.
   - It defines common properties like padding, font, border-radius, etc.
-------------------------------------------------------------------------- */
.btn {
    /* Box Model & Sizing */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.75rem 1.5rem; /* Default padding */
    min-height: 44px; /* Ensures a good touch target size */

    /* Typography */
    font-family: 'Inter', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    text-decoration: none; /* For cases where an <a> tag gets the .btn class */
    letter-spacing: 0.5px;
    white-space: nowrap; /* Prevents text wrapping */

    /* Appearance */
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius);
    cursor: pointer;

    /* Animation & Interaction */
    transition: var(--transition);
    user-select: none; /* Prevent text selection on click */
}

/* --- Base Button States --- */

.btn:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.btn:focus-visible {
    outline: 2px solid var(--primary-green);
    outline-offset: 2px;
}

.btn:disabled,
.btn[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.1);
    transform: none;
    box-shadow: none;
}

/* --------------------------------------------------------------------------
   2. Button Modifiers (.btn--modifier)
   - These classes change the appearance or size of the base .btn.
   - They are used IN ADDITION to the .btn class (e.g., <button class="btn btn--primary">)
-------------------------------------------------------------------------- */

/* --- Purpose & Color Modifiers --- */

.btn--primary {
    background: var(--primary-green);
    color: var(--dark-bg);
    border-color: transparent;
}
.btn--primary:hover {
    background: var(--primary-green-light);
    border-color: transparent;
}

.btn--danger {
    background: rgba(239, 68, 68, 0.2); /* --error with transparency */
    color: #f87171; /* Lighter red for text */
    border-color: rgba(239, 68, 68, 0.4);
}
.btn--danger:hover {
    background: rgba(239, 68, 68, 0.3);
    color: #ef4444;
    border-color: #ef4444; /* Solid red on hover */
}

.btn--info {
    background: rgba(59, 130, 246, 0.2);
    color: #93c5fd;
    border-color: rgba(59, 130, 246, 0.4);
}
.btn--info:hover {
    background: rgba(59, 130, 246, 0.3);
    color: #60a5fa;
    border-color: #3b82f6;
}


/* --- Style & Type Modifiers --- */

.btn--toggle.is-active {
    background: var(--primary-green);
    color: white;
    border-color: transparent;
    box-shadow: 0 0 15px rgba(29, 185, 84, 0.5);
}

/* --- Size Modifiers --- */

.btn--compact {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    font-weight: 500;
    min-height: 36px;
    border-radius: var(--border-radius-sm);
    text-transform: capitalize;
}

/* --------------------------------------------------------------------------
   3. State Class (.is-active)
   - Use this class with JavaScript to programmatically set a button's
     active/toggled state.
   - Works primarily with .btn--toggle.
-------------------------------------------------------------------------- */
.is-active {
    /* This class is a hook. The actual styling is defined
       in the modifier (e.g., .btn--toggle.is-active) */
}





/* ==========================================================================
   GLOBAL STYLES (Adapted from styles.css)
   ========================================================================== */
* { /* Added from with sidebar for consistency */
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    /* Background from 'without sidebar' */
    background: linear-gradient(135deg, #25254d 0%, #262f59 50%, #1a4b8b 100%);
    background-attachment: fixed;
    color: var(--text-primary);
    min-height: 100vh;
    /* Removed padding, display:flex, flex-direction:column, align-items:center, gap from body to allow container to manage layout */
}

.page-title {
    font-size: 3rem; /* From without sidebar */
    font-weight: 800;
    text-align: center;
    margin-bottom: 1rem; /* From without sidebar */
    background: linear-gradient(135deg, var(--primary-green) 0%, #ffffff 100%); /* From without sidebar */
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 0 30px rgba(29, 185, 84, 0.3);
}

/* ==========================================================================
   LAYOUT CONTAINERS (Mixed from both, prioritizing sidebar layout)
   ========================================================================== */
.container { /* From with sidebar */
    display: flex;
    height: 100vh;
}

.main-area { /* From with sidebar */
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 20px; /* From without sidebar general padding for content */
    overflow-y: auto;
    min-height: 0; /* Important: allows flex children to shrink */
    gap: 2rem; /* Added to keep spacing from without sidebar body to elements */
    align-items: center; /* Center content in main-area horizontally */
}

.header {
    text-align: center;
    margin-bottom: 10px;
    width: 100%; /* Ensure header takes full width */
}

/* ==========================================================================
   SCORE AND CONTENT CONTAINERS (PRIORITIZING 'WITHOUT SIDEBAR' STYLES)
   ========================================================================== */
#scoreWrap {
    width: 100%;
    max-width: 1100px; /* Retained from without sidebar */
    background: rgba(229, 231, 235, 0.95); /* From without sidebar */
    color: var(--dark-bg); /* From without sidebar */
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-lg);
    padding: 1rem;
    box-shadow: var(--shadow-lg);
    transition: var(--transition);
    overflow-x: auto;
    scroll-behavior: smooth;
    text-align: center;
}

.controls {
    width: 100%;
    max-width: 1100px; /* Retained from without sidebar */
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-lg);
    padding: 2rem;
    box-shadow: var(--shadow-lg);
    transition: var(--transition);
    padding-bottom: 1.5rem;
    flex-shrink: 0; /* Prevent controls from shrinking */
}

.controls .button-row:first-child {
    margin-bottom: 1.5rem;
}

#scoreWrap:hover,
.controls:hover,
.now-playing-container:hover, /* Added for now-playing and instrument containers */
.instrument-container:hover {
    border-color: rgba(29, 185, 84, 0.3);
    box-shadow: 0 35px 60px -12px rgba(0, 0, 0, 0.9);
}

#score {
    display: inline-block; /* From without sidebar */
    min-width: fit-content;
    text-align: left;
    padding-bottom: 1rem; /* From without sidebar */
    width: auto; /* Allow it to size naturally */
    /* min-height and max-height removed to let it breathe as in 'without sidebar' */
    /* flex-shrink and max-width removed as per 'without sidebar' */
}

#nowPlayingDisplay {
    font-size: 1.75rem; /* From without sidebar */
    font-weight: 700;
    color: var(--primary-green-light); /* From without sidebar */
    min-height: 42px; /* From without sidebar */
    line-height: 42px; /* From without sidebar */
    text-align: center;
    margin-bottom: 1.5rem; /* From without sidebar */
    background: 1a4b8b;
    border-radius: 8px; /* Added for styling */
    padding: 0 12px; /* Added for styling */
    display: flex; /* Added for centering content */
    align-items: center; /* Added for centering content */
    justify-content: center; /* Added for centering content */
    overflow: hidden; /* Added to prevent text overflow */
}

#instrument {
    position: relative;
    width: 100%;
    max-width: 1040px;
    margin: 0 auto;
}

#instrument svg {
    width: 100%;
    height: auto;
    display: block;
}

/* ==========================================================================
   SIDE PANEL STYLES (FROM WITH SIDEBAR - Unchanged)
   ========================================================================== */
.side-panel {
    width: 320px;
    min-height: 100vh; /* Stretch to full height */
    background: rgba(30, 41, 59, 0.95);
    backdrop-filter: blur(10px);
    padding: 20px;
    border-radius: 0 12px 12px 0;
    overflow-y: auto;
    overflow-x: hidden; /* Prevent horizontal scroll */
    flex-shrink: 0; /* Prevent sidebar from shrinking */
}

.panel-section {
    margin-bottom: 24px;
}

.panel-section h3 {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 12px;
    color: #94a3b8;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* ==========================================================================
   FLOATING EDITING PANEL STYLES (from with sidebar - this won't impact main content)
   ========================================================================== */
.editing-panel {
    position: fixed;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    padding: 16px;
    z-index: 4000;
    display: none;
    border: 2px solid #3b82f6;
    min-width: 280px;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    color: #1f2937;
}

.editing-panel.visible {
    display: block;
    animation: panelSlideIn 0.3s ease-out forwards;
}

@keyframes panelSlideIn {
    from { opacity: 0; transform: translate(-50%, -50%) scale(0.98); }
    to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

.panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid #e5e7eb;
}

.panel-header-buttons {
    display: flex;
    gap: 8px;
    align-items: center;
}

.panel-title {
    font-weight: 700;
    color: #1f2937;
    font-size: 16px;
}

.panel-close, .panel-dock {
    background: none;
    border: none;
    color: #64748b;
    cursor: pointer;
    font-size: 18px;
    padding: 4px;
    line-height: 1;
    border-radius: 4px;
    transition: all 0.2s;
}

.panel-close:hover, .panel-dock:hover {
    background: rgba(100, 116, 139, 0.1);
    color: #374151;
}

.editing-panel.docked {
    position: relative !important;
    left: auto !important;
    top: auto !important;
    transform: none !important;
    border: 1px solid #475569;
    background: rgba(30, 41, 59, 0.95);
    backdrop-filter: blur(10px);
    min-width: auto;
    width: 100%;
    margin-top: 0;
}

.editing-panel.docked .panel-title {
    color: white;
}

.editing-panel.docked .panel-close,
.editing-panel.docked .panel-dock {
    color: #94a3b8;
}

.editing-panel.docked .panel-close:hover,
.editing-panel.docked .panel-dock:hover {
    background: rgba(255, 255, 255, 0.1);
    color: white;
}

.editing-panel.docked .control-label {
    color: #94a3b8;
}

.editing-panel.docked .control-btn {
    background: rgba(255, 255, 255, 0.1);
    border-color: #475569;
    color: #e2e8f0;
}

.editing-panel.docked .control-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: #3b82f6;
}

.editing-panel.docked .control-btn.active {
    background: #3b82f6;
    color: white;
    border-color: #3b82f6;
}

.editing-panel.docked .dropdown-select {
    background: rgba(255, 255, 255, 0.1);
    border-color: #475569;
    color: #e2e8f0;
}

.editing-panel.docked #currentPitch {
    color: white;
}

.panel-controls {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.control-label {
    font-size: 13px;
    color: #4a5568;
    min-width: 60px;
    font-weight: 600;
}

.control-btn {
    padding: 8px 12px;
    border: 1px solid #cbd5e0;
    border-radius: 8px;
    background: white;
    color: #374151;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.15s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
}

.control-btn:hover {
    background: #f0f4f8;
    border-color: #3b82f6;
    color: #1a202c;
}

.control-btn.active {
    background: #3b82f6;
    color: white;
    border-color: #3b82f6;
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
}

.control-btn-icon {
    font-size: 1.2em;
    margin-right: 4px;
}

#currentPitch {
    font-weight: bold;
    font-size: 1.1em;
    color: #1f2937;
    min-width: 40px;
    text-align: center;
    background: white;
    border: 1px solid #cbd5e0;
    border-radius: 6px;
    padding: 6px 8px;
}

.dropdown-select {
    padding: 6px 8px;
    border: 1px solid #cbd5e0;
    border-radius: 6px;
    background-color: white;
    font-size: 13px;
    color: #374151;
    cursor: pointer;
}

/* ==========================================================================
   BUTTON ROWS AND NAVIGATION (Mostly from without sidebar, some adjustments for sidebar context)
   ========================================================================== */
.button-row,
.checkbox-row {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    gap: 1rem;
}
.playback-controls {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-bottom: 30px;
}

.measure-nav, .editor-measure-nav { /* From with sidebar, as these are editor-specific */
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 20px;
    justify-content: center;
    flex-wrap: wrap;
}

.editor-measure-nav h2 { /* From with sidebar */
    font-size: 14px;
    color: #94a3b8;
    font-weight: 600;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
}

.measure-input, .nav-btn { /* From with sidebar */
    padding: 6px 8px;
    border: 1px solid #475569;
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.2s;
}

.measure-input { /* From with sidebar */
    width: 50px;
    text-align: center;
}

.nav-btn:hover:not(:disabled) { /* From with sidebar */
    background: rgba(255, 255, 255, 0.2);
}

.nav-btn:disabled { /* From with sidebar */
    opacity: 0.5;
    cursor: not-allowed;
}

/* ==========================================================================
   CHORD BUTTONS CONTAINER STYLES (from with sidebar, adapted for max-width)
   ========================================================================== */
#chordButtons {
    width: 100%;
    max-width: 1100px; /* From without sidebar */
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-lg);
    padding: 1.5rem; /* From with sidebar */
    box-shadow: var(--shadow-lg);
    transition: var(--transition);
    margin-top: 1rem; /* From with sidebar */
    flex-shrink: 0;
}

#chordButtons.hidden {
    display: none;
}

#chordGroupsContainer { /* From with sidebar */
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: center;
}

.chord-section {
    margin-bottom: 1.5rem; /* From with sidebar */
}

.chord-section h4 {
    font-size: 1.25rem; /* From with sidebar */
    font-weight: 700;
    color: var(--text-primary);
    text-align: center;
    margin-bottom: 1rem; /* From with sidebar */
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.chord-grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.75rem;
}

.chord-btn {
    padding: 0.75rem 1.25rem;
    font-size: 0.9rem;
    text-transform: capitalize;
    border: 1px solid var(--glass-border);
    background: rgba(255, 255, 255, 0.05);
}

.chord-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
}

.chord-btn.active {
    background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
    color: white;
    border-color: transparent;
    box-shadow: 0 0 10px rgba(29, 185, 84, 0.5);
}

/* ==========================================================================
   PIANO & OVERLAYS (PRIORITIZING 'WITHOUT SIDEBAR' STYLES)
   ========================================================================== */
#gate {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(30, 30, 30, 0.8);
    backdrop-filter: blur(5px);
    cursor: pointer;
    z-index: 10;
    border-radius: var(--border-radius-lg);
}

#gate p {
    padding: 1rem 1.5rem;
    border: 2px solid var(--primary-green);
    border-radius: var(--border-radius);
    color: var(--text-primary);
    font-size: 1.2rem;
    font-weight: 600;
    background: rgba(29, 185, 84, 0.1);
}

/* Piano Key Styling */
#instrument .white { fill: #FFFFFF; stroke: #444; }
#instrument .black { fill: #333333; stroke: #000; }
#instrument .white.pressed { fill: #D1D5DB; }
#instrument .black.pressed { fill: #555555; }

/* Hand Position / Note Function Highlighting */
#instrument .left-white  { fill: #3b82f6 !important; }
#instrument .left-black  { fill: #1d4ed8 !important; }
#instrument .middle      { fill: #8b5cf6 !important; }
#instrument .right-white { fill: #ec4899 !important; }
#instrument .right-black { fill: #be185d !important; }

/* Chord Highlighting */
#instrument .chord-root { fill: var(--primary-green-light) !important; }
#instrument .chord-third { fill: var(--warning) !important; }
#instrument .chord-fifth { fill: var(--info) !important; }

#handOverlay {
    position: absolute;
    height: 16px;
    background: rgba(29, 185, 84, 0.2);
    border: 1px solid var(--primary-green);
    border-radius: 8px;
    top: -20px;
    cursor: grab;
    touch-action: none;
    backdrop-filter: blur(2px);
}

#handOverlay.chord-mode {
    background: rgba(116, 192, 252, 0.2);
    border-color: var(--info);
}

/* ==========================================================================
   EDITOR SPECIFIC STYLES (from with sidebar, as these relate to the floating/docked panel)
   ========================================================================== */

.note-editor-expanded {
    background: rgba(255, 255, 255, 0.08);
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.note-editor-title {
    color: white;
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.note-editor-title::before {
    content: "ðŸŽµ";
    font-size: 18px;
}

.move-controls {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.move-controls .control-button {
    flex: 1;
    min-width: 120px;
}

.control-group {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
    margin-bottom: 12px;
}

.control-group label {
    font-size: 13px;
    color: #94a3b8;
    min-width: 80px;
    font-weight: 600;
}

.control-group select, .control-group input[type="number"] {
    padding: 6px 8px;
    border: 1px solid #475569;
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    font-size: 13px;
}

.notes-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 16px;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
}

.editor-note-select {
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.1) !important;
    border: 1px solid #475569;
    color: white;
    border-radius: 6px;
    font-size: 12px;
    transition: all 0.2s;
}

.editor-note-select:hover {
    background: rgba(255, 255, 255, 0.2) !important;
}

.editor-note-select.active-note-select {
    background: #3b82f6 !important;
    border-color: #3b82f6;
}

.add-note-initial {
    background: rgba(34, 197, 94, 0.2) !important;
    border: 1px dashed #22c55e;
    color: #22c55e;
    font-weight: bold;
}

.add-note-initial:hover {
    background: rgba(34, 197, 94, 0.3) !important;
}

.remove-note-initial {
    background-color: rgba(255, 107, 107, 0.1);
    border-color: rgba(255, 107, 107, 0.3);
    color: var(--error);
}

.remove-note-initial:hover {
    background-color: rgba(255, 107, 107, 0.2);
    border-color: rgba(255, 107, 107, 0.5);
}

/* Chord editor styles */
.chord-note-item {
    background: rgba(255, 255, 255, 0.05);
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #475569;
    margin-bottom: 8px;
}

.chord-note-item select {
    margin: 0 4px;
}

.remove-chord-note-btn {
    background: #ef4444 !important;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
    margin-left: 8px;
    cursor: pointer;
    font-size: 12px;
}

.remove-chord-note-btn:hover {
    background: #dc2626 !important;
}

/* ==========================================================================
   MUSIC EDITOR UI (Editor IDs) - Styled for consistency with theme
   (Mostly from 'without sidebar' but with 'with sidebar' specifics for some elements for consistency with sidebar)
   ========================================================================== */

/* Main Editor Container */
#editorEditBox {
    width: 100%;
    max-width: 1100px; /* From without sidebar */
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border-radius: var(--border-radius-lg);
    padding: 2rem;
    box-shadow: var(--shadow-lg);
    transition: var(--transition);
    margin-top: 2rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: var(--text-primary);
}

/* Measure Controls Header - Prioritize without sidebar values, but keep flex properties for layout */
#editorControlsHeader {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem; /* From without sidebar */
    font-size: 1rem; /* From without sidebar */
    font-weight: 300; /* From without sidebar */
    color: var(--text-primary);
    margin-bottom: 1.5rem; /* From without sidebar */
    flex-wrap: wrap; /* Added for responsiveness from with sidebar */
    width: 100%; /* Added for responsiveness from with sidebar */
}

#editorControlsHeader span {
    color: var(--text-primary);
    white-space: nowrap; /* Added from with sidebar */
}

/* Measure Number Input - Prioritize without sidebar values */
#editorNumberInput {
    width: 80px; /* From without sidebar */
    text-align: center;
    padding: 0.75rem 0.5rem; /* From without sidebar */
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius);
    font-size: 1.25rem; /* From without sidebar */
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-primary);
    -webkit-appearance: textfield;
    -moz-appearance: textfield;
    appearance: textfield;
}

/* Hide number input arrows */
#editorNumberInput::-webkit-outer-spin-button,
#editorNumberInput::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

#editorNumberInput:focus,
#editorNumberInput:focus-visible {
    outline: 2px solid var(--primary-green);
    outline-offset: 2px;
    border-color: var(--primary-green-light);
    background: rgba(255, 255, 255, 0.1);
}

/* Prev/Next Measure Buttons - Prioritize without sidebar values */
#editorPrevBtn,
#editorNextBtn {
    padding: 0.5rem 1rem; /* From without sidebar */
    font-size: 1.5rem; /* From without sidebar */
    line-height: 1;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius);
    color: var(--text-primary);
    min-width: 36px; /* From with sidebar */
}

#editorPrevBtn:disabled,
#editorNextBtn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: rgba(255, 255, 255, 0.02);
    border-color: rgba(255, 255, 255, 0.05);
}


/* Treble/Bass Notes Containers - From without sidebar */
#editorTrebleNotesContainer,
#editorBassNotesContainer {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
    gap: 0.5rem;
    margin-bottom: 1rem;
    padding: 0.75rem;
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius);
    background: rgba(255, 255, 255, 0.03);
    min-height: 60px;
    align-items: center;
}

/* Flex items for note buttons and add/remove - From without sidebar */
.flex-items-center-gap-1 {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

/* Note Selection Buttons (e.g., C4, D4) - From without sidebar */
.note-select {
    padding: 0.5rem 0.8rem;
    font-size: 0.9rem;
    font-weight: 600;
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius);
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-primary);
    transition: var(--transition);
    min-width: 60px;
    text-align: center;
}

.note-select:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.25);
}

.note-select.active-note-select {
    background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
    color: white;
    border-color: transparent;
    box-shadow: 0 0 10px rgba(29, 185, 84, 0.5);
}

/* Add/Remove Note Buttons (initial view) - From without sidebar */
.add-note-initial,
.remove-note-initial {
    padding: 0.3rem 0.6rem;
    font-size: 0.8rem;
    font-weight: 700;
    border-radius: var(--border-radius-sm);
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    color: var(--text-primary);
    transition: var(--transition);
}

.add-note-initial:hover,
.remove-note-initial:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.25);
}

/* Specific colors for add/remove buttons - From without sidebar */
.add-note-initial {
    background-color: rgba(66, 153, 225, 0.1);
    border-color: rgba(66, 153, 225, 0.3);
    color: var(--info);
}
.add-note-initial:hover {
    background-color: rgba(66, 153, 225, 0.2);
    border-color: rgba(66, 153, 225, 0.5);
}

.remove-note-initial {
    background-color: rgba(255, 107, 107, 0.1);
    border-color: rgba(255, 107, 107, 0.3);
    color: var(--error);
}
.remove-note-initial:hover {
    background-color: rgba(255, 107, 107, 0.2);
    border-color: rgba(255, 107, 107, 0.5);
}


/* Expanded Editor Section - From without sidebar */
#editorExpandedEditor {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.5rem;
    border-top: 1px solid var(--glass-border);
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    gap: 1.5rem;
}

#editorExpandedEditor.hidden {
    display: none;
}

#editorSelectedNoteDisplay {
    color: var(--info);
    font-weight: 700;
}

/* Control Groups (Note, Clef, Letter, etc.) - From without sidebar */
#editorExpandedEditor > div:first-of-type,
#editorExpandedEditor > div:last-of-type {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    gap: 1rem;
}

.control-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.control-group label {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* Text Input for Note (e.g., C4q) - From without sidebar */
.text-input-note {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius);
    padding: 0.5rem 1rem;
    color: var(--text-primary);
    font-size: 1rem;
    text-align: center;
    min-width: 100px;
}

.text-input-note:focus,
.text-input-note:focus-visible {
    outline: 2px solid var(--primary-green);
    outline-offset: 2px;
    border-color: var(--primary-green-light);
    background: rgba(255, 255, 255, 0.1);
}

/* Dropdowns (Select elements) - From without sidebar */
#editorExpandedEditor select {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius);
    padding: 0.5rem 1rem;
    color: var(--text-primary);
    font-size: 1rem;
    -webkit-appearance: none;
    appearance: none;
    background-image: none;
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 0.8em;
    min-width: 120px;
}

/* Fix for white text on white background in dropdown options - From without sidebar */
#editorExpandedEditor select option {
    background-color: var(--dark-bg);
    color: var(--text-primary);
}

#editorExpandedEditor select:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: var(--glass-border);
}

#editorExpandedEditor select:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    background: rgba(255, 255, 255, 0.02);
    border-color: rgba(255, 255, 255, 0.05);
}


/* Control Buttons (Apply, Toggle Clef, Rests, Add/Remove) - From without sidebar */
#editorExpandedEditor .control-button {
    padding: 0.75rem 1.25rem;
    font-size: 0.9rem;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid var(--glass-border);
    color: var(--text-primary);
}

#editorExpandedEditor .control-button:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: var(--glass-border);
}

#editorExpandedEditor .control-button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    background: rgba(255, 255, 255, 0.02);
    border-color: rgba(255, 255, 255, 0.05);
}

/* Specific colors for action buttons (matching theme) - From without sidebar */
#editorApplyNoteText { background-color: var(--primary-green); border-color: var(--primary-green-dark); transition: var(--transition); }
#editorApplyNoteText:hover { background-color: var(--primary-green-light); border-color: var(--primary-green); }

#editorToggleClef { background-color: var(--info); border-color: var(--info); transition: var(--transition); }
#editorToggleClef:hover { background-color: var(--info); border-color: var(--info); }

#editorTrebleRestButton, #editorBassRestButton { background-color: var(--success); border-color: var(--success); transition: var(--transition); }
#editorTrebleRestButton:hover, #editorBassRestButton:hover { background-color: var(--success); border-color: var(--success); }

#editorRemoveNote { background-color: var(--error); border-color: var(--error); transition: var(--transition); }
#editorRemoveNote:hover { background-color: var(--error); border-color: var(--error); }

#editorAddNoteBefore, #editorAddNoteAfter { background-color: var(--info); border-color: var(--info); transition: var(--transition); }
#editorAddNoteBefore:hover, #editorAddNoteAfter:hover { background-color: var(--info); border-color: var(--info); }

/* ==========================================================================
   DURATION COLOR CLASSES (From without sidebar)
   ========================================================================== */
.note-duration-32 { background-color: #ADD8E6; }
.note-duration-32dot { background-color: #9ACFE0; }
.note-duration-16 { background-color: #87CEEB; }
.note-duration-16dot { background-color: #75C2E0; }
.note-duration-8 { background-color: #6495ED; }
.note-duration-8dot { background-color: #5283E0; }
.note-duration-q { background-color: #4169E1; }
.note-duration-qdot { background-color: #3159C1; }
.note-duration-h { background-color: #483D8B; }
.note-duration-hdot { background-color: #8A2BE2; }
.note-duration-w { background-color: #4B0082; }
.note-duration-wdot { background-color: #3A0060; }

/* Duration-based styling for note buttons (from with sidebar, as it's a visual indicator) */
.note-duration-q { border-left: 4px solid #22c55e; }
.note-duration-h { border-left: 4px solid #3b82f6; }
.note-duration-e { border-left: 4px solid #f59e0b; }
.note-duration-w { border-left: 4px solid #a855f7; }
.note-duration-qdot { border-left: 4px solid #22c55e; border-style: dotted; }
.note-duration-hdot { border-left: 4px solid #3b82f6; border-style: dotted; }


/* Active/Selected style for duration buttons in piano roll */
.control-button.active-duration {
    border: 2px solid var(--text-primary);
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
}

/* ==========================================================================
   FLEX UTILITIES (from with sidebar)
   ========================================================================== */
.flex-items-center-gap-1 {
    display: flex;
    align-items: center;
    gap: 4px;
}

/* ==========================================================================
   UTILITY CLASSES (from with sidebar)
   ========================================================================== */
.hidden {
    display: none !important;
}

/* ==========================================================================
   SCROLLBAR STYLES (From without sidebar - consistent between both)
   ========================================================================== */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--primary-green);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--primary-green-light);
}

/* ==========================================================================
   RESPONSIVE DESIGN (Mixed from both, prioritizing sidebar responsiveness)
   ========================================================================== */
@media (max-width: 1024px) {
    .container { /* From with sidebar */
        flex-direction: column;
        height: auto;
    }
    
    .side-panel { /* From with sidebar */
        width: 100%;
        min-height: auto;
        border-radius: 0;
        order: -1;
        max-height: 300px;
    }

    .main-area { /* From with sidebar */
        padding: 10px; /* Adjusted padding from without sidebar */
        height: auto;
        gap: 1rem; /* Adjusted gap for mobile */
    }

    .score-container { /* Re-added, if an outer score container exists */
        min-height: 400px;
        max-height: 500px;
    }

    #score { /* From with sidebar, adjusted for score within its container */
        min-height: 350px;
    }

    .playback-controls { /* Adjusted for mobile */
        margin-bottom: 15px;
    }

    .btn, .control-button { /* Adjusted for mobile */
        padding: 10px 16px;
        font-size: 13px;
    }

    .editing-panel { /* From with sidebar, general floating panel behavior */
        min-width: unset;
        width: 90%;
        left: 5%;
        top: 20px;
        transform: translateX(0);
    }

    .editor-measure-nav { /* From with sidebar, editor specific */
        margin-bottom: 12px;
    }

    .control-group { /* From with sidebar, general control group behavior */
        flex-direction: column;
        align-items: flex-start;
    }

    .control-group label { /* From with sidebar */
        min-width: auto;
        margin-bottom: 4px;
    }

    .move-controls .control-button { /* From with sidebar */
        min-width: 100px;
        font-size: 12px;
        padding: 8px 10px;
    }

    /* Make measure navigation even more compact on mobile - From with sidebar */
    #editorControlsHeader {
        font-size: 0.9rem;
        gap: 0.3rem;
    }

    #editorNumberInput {
        width: 45px;
        font-size: 0.9rem;
    }

    #editorPrevBtn,
    #editorNextBtn {
        padding: 0.3rem 0.5rem;
        font-size: 1rem;
        min-width: 32px;
    }

    /* Adjust now playing for mobile - From with sidebar, using without sidebar sizing */
    #nowPlayingDisplay {
        height: 60px; /* From with sidebar */
        line-height: 60px; /* From with sidebar */
        font-size: 1.5rem; /* From with sidebar */
    }

    .now-playing-container { /* From with sidebar, adjusted padding */
        padding: 1rem;
        margin-bottom: 15px;
    }
}

#dockedEditingContainer { /* From with sidebar */
    display: none;
}


        /* Note Palette */
        .note-palette-container {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .palette-header {
            color: white;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
            text-align: center;
        }

        .note-palette {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .palette-note {
            width: 60px;
            height: 45px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid white;
            border-radius: 8px;
            color: #1f2937;
            cursor: grab;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 700;
            transition: all 0.2s;
            user-select: none;
        }

        .palette-note:hover {
            background: white;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .palette-note:active {
            cursor: grabbing;
        }

        .note-duration {
            font-size: 9px;
            margin-top: 2px;
            opacity: 0.7;
            font-weight: 500;
        }

        .chord-major {
            background: linear-gradient(135deg, #22c55e, #16a34a) !important;
            color: white !important;
            border-color: #22c55e !important;
        }

        .chord-minor {
            background: linear-gradient(135deg, #a855f7, #9333ea) !important;
            color: white !important;
            border-color: #a855f7 !important;
        }

        .palette-separator {
            width: 2px;
            height: 40px;
            background: rgba(255, 255, 255, 0.4);
            margin: 0 5px;
        }

        /* Editing Panel - Added from tool tip.html */
        .editing-panel {
            position: fixed;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            padding: 16px;
            z-index: 4000;
            display: none;
            border: 2px solid #3b82f6;
            min-width: 280px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .editing-panel.visible {
            display: block;
            animation: panelSlideIn 0.3s ease-out forwards;
        }

        @keyframes panelSlideIn {
            from { opacity: 0; transform: translateY(-10px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e7eb;
        }

        .panel-header-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .panel-title {
            font-weight: 700;
            color: #1f2937;
            font-size: 16px;
        }

        .panel-close, .panel-dock {
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
            line-height: 1;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .panel-close:hover, .panel-dock:hover {
            background: rgba(100, 116, 139, 0.1);
            color: #374151;
        }

        .editing-panel.docked {
            position: relative !important;
            left: auto !important;
            top: auto !important;
            transform: none !important;
            border: 1px solid #475569;
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            min-width: auto;
            width: 100%;
            margin-top: 0;
        }

        .editing-panel.docked .panel-title {
            color: white;
        }

        .editing-panel.docked .panel-close,
        .editing-panel.docked .panel-dock {
            color: #94a3b8;
        }

        .editing-panel.docked .panel-close:hover,
        .editing-panel.docked .panel-dock:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .editing-panel.docked .control-label {
            color: #94a3b8;
        }

        .editing-panel.docked .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border-color: #475569;
            color: #e2e8f0;
        }

        .editing-panel.docked .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #3b82f6;
        }

        .editing-panel.docked .control-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .editing-panel.docked .dropdown-select {
            background: rgba(255, 255, 255, 0.1);
            border-color: #475569;
            color: #e2e8f0;
        }

        .editing-panel.docked #currentPitch {
            color: white;
        }

        .panel-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .control-label {
            font-size: 13px;
            color: #4a5568;
            min-width: 60px;
            font-weight: 600;
        }

        .control-btn {
            padding: 8px 12px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            background: white;
            color: #374151;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .control-btn:hover {
            background: #f0f4f8;
            border-color: #3b82f6;
            color: #1a202c;
        }

        .control-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .control-btn-icon {
            font-size: 1.2em;
            margin-right: 4px;
        }

        #currentPitch {
            font-weight: bold;
            font-size: 1.1em;
            color: #1f2937;
            min-width: 40px;
            text-align: center;
        }

        .dropdown-select {
            padding: 6px 8px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            background-color: white;
            font-size: 13px;
            color: #374151;
            cursor: pointer;
        }